Node的污点  
===
- NoSchedule:不能容忍此污点的新Pod对象不可调度至当前节点,属于强制型约束关系,节点上现存的 Pod 对象不受影响。

- PreferNoSchedule:NoSchedule的柔性约束版本,即不能容忍此污点的新 Pod 对象尽量不要调度至当前节点,不过无其他节点可供调度时也允许接受相应的Pod对象.节点上现存的Pod对象不受影响。

- NoExecute:不能容忍此污点的新Pod对象不可调度至当前节点,属于强制型约束关系,而且节点上现存的Pod对象因节点污点变动或Pod容忍度变动而不再满足匹配规则时,Pod对象将被驱逐。 

- 一个节点可以使用配置使用多个污点，一个pod对象也可以有多个容忍度

kubernetes内建使用的污点  
```
node.kubernetes.io/not-ready:    节点进入"NotReady"状态时被自动添加的污点
node.alpha.kubernetes.io/unreachable:   节点进入"NotReachable"状态时被自动添加的污点。 
node.kubernetes.io/out-of-disk:     节点进入"OutOfDisk"状态时被自动添加的污点
node.kubernetes.io/memory-pressure:    节点内存资源面临压力
node.kubernetes.io/ disk-pressure:   节点磁盘资源面临压力
node.kubernetes.io/network-unavailable:    节点网络不可用
node.kubernetes.io/unschedulable： 节点不可调度
node.cloudprovider.kubernetes.io/uninitialized:   kubelet由外部的云环境程序启动时,它将自动为节点添加此污点,待到云控制器管理器中的控制器初始化此节点时再将 其删除。 
```  

1、查看污点
```
$ kubectl get node
NAME            STATUS   ROLES    AGE    VERSION
k8s-master      Ready    master   102d   v1.16.6
k8s-node-2-12   Ready    <none>   102d   v1.16.6
k8s-node-2-13   Ready    <none>   102d   v1.16.6


$ kubectl describe nodes k8s-master
...
CreationTimestamp:  Sat, 23 Nov 2019 00:52:45 +0800
Taints:             node-role.kubernetes.io/master:PreferNoSchedule
Unschedulable:      false
...
```



2、为node设置taint
```
语法  
# kubectl taint nodes <node name> <key>=<value> : <effect>    #key和value可以根据自己需求任意定义  

## 设置污点并不允许 Pod 调度到该节点
# kubectl taint nodes node1 node-type=production:NoSchedule

## 设置污点尽量阻止污点调度到该节点
# kubectl taint nodes node2 node-role=admin:PreferNoSchedule

## 设置污点，不允许普通 Pod 调度到该节点，且将该节点上已经存在的 Pod 进行驱逐
# kubectl taint nodes node3 node-storage=ssd:NoExecute
```  

2、删除上面的taint  
```
语法：  
# kubectl taint nodes <node-name> <key>{:<effect>}-  

删除污点，可以不指定 value，指定 [effect] 值就可删除该 key:[effect] 的污点
# kubectl taint nodes node1 node-type:NoSchedule-
# kubectl taint nodes node2 node-role:PreferNoSchedule-
# kubectl taint nodes node3 node-storage:NoExecute-
```  

3、删除指定键名的所有污点  
```
## 也可以根据 key 直接将该 key 的所有 [effect] 都删除：
# kubectl taint nodes node1 node-type-
```  

4、删除节点上全部污点信息  
``` # kubectl patch nodes node1 -p '{"spec":{"taints":[]}}' ```  


Pod对象的容忍度  
===
```
tolerations:                                        #spec字段下的容忍度配置              
- key: "node-type"                                  #可以容忍的自定义的key          
  operator: "Equal"                                 #污点信息完全匹配的等值
  value: "production"                               #可以容忍的自定义的value
  effect: "NoSchedule"                              #容忍的污点类型
- key: "node-role"
  operator: "Exists"                                ##Exists表示key存在就能容忍，value的值设置也不会不生效
  value: "admin"
  effect: "PreferNoSchedule"
- key: "node.alpha.kubernetes.io/unreachable"
  operator: "Exists"                                #Exists表示key存在就能容忍，无需设置value
  effect: "NoExecute"
  tolerationSeconds: 6000                           #定义延迟驱逐当前Pod对象的时长，只能在NoExecute字段设置
```  


当不指定 key 值时，表示容忍所有的污点 key  
```
tolerations:
- operator: "Exists"
```  

当不指定 effect 值时，表示容忍所有的污点作用  
```
tolerations:
- key: "key"
  operator: "Exists"
```  

