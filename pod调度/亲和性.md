| 调度策略 | 匹配标签 | 操作符 | 拓扑域支持 | 调度目标 |
| :------: | :--------: | :-------: | :-----: | :---------: |
| nodeAffinity | 主机 | In, NotIn, Exists,DoesNotExist, Gt, Lt | 否 | 指定主机 |
| podAffinity | POD | In, NotIn, Exists,DoesNotExist | 是 | POD与指定POD同一拓扑域 |
| podAnitAffinity | POD | In, NotIn, Exists,DoesNotExist | 是 | POD与指定POD不在同一拓扑域 |


节点硬亲和性  
```
apiVersion: v1
kind: Pod
metadata:
  name: with-required-nodeaffinity-2
spec:
  affinity:
    nodeAffinity:                                                    #节点亲和性
      requiredDuringSchedulingIgnoredDuringExecution:                #硬亲和性
        nodeSelectorTerms:                                           #标签选择器
        - matchExpressions:                                          #匹配的标签
          - {key: zone, operator: In, values: ["foo", "bar"]}        #根据values匹配，值不能为空 operator选项有In、NotIn
          - {key: ssd, operator: Exists, values: []}                 #存在性匹配，值必选为空  operator选项Exists、DoesNotExist
  containers:
  - name: myapp
    image: ikubernetes/myapp:v1
    resources:
      requests:
        cpu: 6
        memory: 20Gi
```  
键值运算关系  
- In：label 的值在某个列表中
- NotIn：label 的值不在某个列表中
- Gt：label 的值大于某个值
- Lt：label 的值小于某个值
- Exists：某个 label 存在
- DoesNotExist：某个 label 不存在


节点软亲和性  
```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-deploy-with-node-affinity
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      name: myapp-pod
      labels:
        app: myapp
    spec:
      affinity:
        nodeAffinity:                                              #节点亲和性
          preferredDuringSchedulingIgnoredDuringExecution:         #软亲和性
          - weight: 60                                             #权重1-100数值越高优先级越高
            preference:
              matchExpressions:                                    #匹配方式
              - {key: zone, operator: In, values: ["foo"]}
          - weight: 30
            preference:
              matchExpressions:
              - {key: ssd, operator: Exists, values: []}
      containers:
      - name: myapp
        image: ikubernetes/myapp:v1
```  

pod硬亲和性
```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-with-pod-affinity
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      name: myapp
      labels:
        app: myapp
    spec:
      affinity:
        podAffinity:                                            #pod亲和性
          requiredDuringSchedulingIgnoredDuringExecution:       #硬亲和性
          - labelSelector:                                      #标签选择器
              matchExpressions:                                 #匹配方法
              - {key: app, operator: In, values: ["db"]}
            topologyKey: zone                                   #以节点标签的key为标准，值做区分是pod运行的节点
      containers:
      - name: myapp
        image: ikubernetes/myapp:v1
```  


pod软亲和性
```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-with-preferred-pod-affinity
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      name: myapp
      labels:
        app: myapp
    spec:
      affinity:
        podAffinity:                                             #pod亲和性
          preferredDuringSchedulingIgnoredDuringExecution:       #软亲和性
          - weight: 80
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - {key: app, operator: In, values: ["db"]}
              topologyKey: rack
          - weight: 20
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - {key: app, operator: In, values: ["db"]}
              topologyKey: zone
      containers:
      - name: myapp
        image: ikubernetes/myapp:v1
```  


pod反亲和性  
```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-with-pod-anti-affinity
spec:
  replicas: 4
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      name: myapp
      labels:
        app: myapp
    spec:
      affinity:
        podAntiAffinity:                                       #反亲和性
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - {key: app, operator: In, values: ["myapp"]}
            topologyKey: kubernetes.io/hostname
      containers:
      - name: myapp
        image: ikubernetes/myapp:v1
```
